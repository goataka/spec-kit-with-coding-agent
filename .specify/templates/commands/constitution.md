---
description: 対話的または提供された原則入力からプロジェクト憲法を作成または更新し、すべての依存テンプレートを同期したまま保ちます。
handoffs: 
  - label: 仕様を構築
    agent: speckit.specify
    prompt: 更新された憲法に基づいて機能仕様を実装します。私は構築したいと思います...
---

## ユーザー入力

```text
$ARGUMENTS
```

空でない場合、続行する前にユーザー入力を **必ず** 考慮してください。

## 概要

`/memory/constitution.md`のプロジェクト憲法を更新しています。このファイルは角括弧内のプレースホルダートークン（例：`[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）を含むテンプレートです。あなたの仕事は、(a) 具体的な値を収集/導出し、(b) テンプレートを正確に埋め、(c) 依存アーティファクト全体で修正を伝播することです。

この実行フローに従います：

1. `/memory/constitution.md`の既存の憲法テンプレートを読み込みます。
   - `[ALL_CAPS_IDENTIFIER]`形式のすべてのプレースホルダートークンを識別します。
   **重要**: ユーザーはテンプレートで使用されているものよりも多くまたは少ない原則を必要とする場合があります。数が指定されている場合は、それを尊重 - 一般的なテンプレートに従います。それに応じてドキュメントを更新します。

2. プレースホルダーの値を収集/導出：
   - ユーザー入力（会話）が値を提供する場合は、それを使用します。
   - それ以外の場合は、既存のリポジトリコンテキスト（README、docs、埋め込まれている場合は以前の憲法バージョン）から推測します。
   - ガバナンス日付の場合：`RATIFICATION_DATE`は元の採用日（不明な場合は尋ねるかTODOをマーク）、`LAST_AMENDED_DATE`は変更が加えられた場合は今日、そうでない場合は以前のものを保持します。
   - `CONSTITUTION_VERSION`はセマンティックバージョニングルールに従ってインクリメントする必要があります：
     - MAJOR: 後方互換性のないガバナンス/原則の削除または再定義
     - MINOR: 新しい原則/セクションが追加されたか、実質的に拡張されたガイダンス
     - PATCH: 明確化、表現、誤字修正、非セマンティックな改良
   - バージョンバンプのタイプが曖昧な場合は、確定する前に理由を提案します。

3. 更新された憲法の内容を起草：
   - すべてのプレースホルダーを具体的なテキストで置き換えます（プロジェクトがまだ定義しないことを選択した意図的に保持されたテンプレートスロットを除き、括弧付きトークンは残さない—残されたものは明示的に正当化）
   - 見出し階層を保持し、コメントは置き換えられたら削除できますが、まだ明確化ガイダンスを追加する場合は除きます。
   - 各原則セクションを確認：簡潔な名前行、交渉不可能なルールを捕捉する段落（または箇条書きリスト）、明白でない場合は明示的な理由
   - ガバナンスセクションが修正手順、バージョニングポリシー、およびコンプライアンスレビュー期待値をリストしていることを確認

4. 一貫性伝播チェックリスト（以前のチェックリストをアクティブな検証に変換）:
   - `/templates/plan-template.md`を読み、"Constitution Check"またはルールが更新された原則と整合していることを確認
   - `/templates/spec-template.md`をスコープ/要件の整合性のために読み、憲法が必須セクションまたは制約を追加/削除した場合は更新
   - `/templates/tasks-template.md`を読み、タスクの分類が新しいまたは削除された原則駆動のタスクタイプ（例：可観測性、バージョニング、テスト規律）を反映していることを確認
   - `/templates/commands/*.md`（これを含む）の各コマンドファイルを読み、汎用ガイダンスが必要な場合にCLAUDEなどのエージェント固有の名前の古い参照が残っていないことを確認
   - 任意のランタイムガイダンスドキュメント（例：`README.md`、`docs/quickstart.md`、またはエージェント固有のガイダンスファイル）を読みます。変更された原則への参照を更新

5. 同期影響レポートを作成（更新後に憲法ファイルの上部にHTMLコメントとして前置）:
   - バージョン変更: 旧 → 新
   - 変更された原則のリスト（名前が変更された場合は旧タイトル → 新タイトル）
   - 追加されたセクション
   - 削除されたセクション
   - 更新が必要なテンプレート（✅ 更新済み / ⚠ 保留中）とファイルパス
   - プレースホルダーが意図的に延期された場合のフォローアップTODO

6. 最終出力前の検証:
   - 説明されていない括弧付きトークンが残っていない
   - バージョン行がレポートと一致
   - ISO形式YYYY-MM-DDの日付
   - 原則は宣言的でテスト可能であり、曖昧な言葉がない（"should" → 適切な場所でMUST/SHOULD理由に置き換え）

7. 完成した憲法を`/memory/constitution.md`に書き戻します（上書き）。

8. ユーザーに最終要約を出力：
   - 新しいバージョンとバンプの理由
   - 手動フォローアップのためにフラグが立てられたファイル
   - 推奨されるコミットメッセージ（例：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）

フォーマットとスタイル要件:

- テンプレートと全く同じようにMarkdown見出しを使用（レベルを降格/昇格しない）
- 読みやすさを保つために長い理由の行を折り返す（理想的には<100文字）が、不自然な改行で厳密に強制しない
- セクション間に1つの空白行を保持
- 末尾の空白を避ける

ユーザーが部分的な更新（例：1つの原則の改訂のみ）を提供する場合でも、検証とバージョン決定ステップを実行します。

重要な情報が欠落している場合（例：批准日が本当に不明）、`TODO(<FIELD_NAME>): explanation`を挿入し、延期された項目の下の同期影響レポートに含めます。

新しいテンプレートを作成しないでください。常に既存の`/memory/constitution.md`ファイルで操作します。
